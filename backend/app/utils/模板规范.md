# 对账单导出模板规范

## 一、目录结构

模板文件应放置在以下目录结构中：

```
public/
├── purchase/          # 采购对账单模板目录
│   ├── 通用模板.xlsx
│   ├── 供应商A_模板.xlsx
│   └── 供应商B_模板.xlsx
└── sale/              # 销售对账单模板目录
    ├── 通用模板.xlsx
    ├── 客户A_模板.xlsx
    └── 客户B_模板.xlsx
```

## 二、模板文件命名规则

### 2.1 通用模板
- 文件名：`通用模板.xlsx`
- 用途：当没有找到特定实体的模板时使用

### 2.2 特定模板
- 文件名格式：`{实体名称}_模板.xlsx`
- 示例：
  - 采购对账单：`某某供应商_模板.xlsx`
  - 销售对账单：`某某客户_模板.xlsx`
- 匹配规则：系统会根据 `supplier_name`（采购）或 `purchaser_name`（销售）自动查找对应的模板

## 三、占位符说明

### 3.1 基本信息占位符

使用双大括号 `{{}}` 包裹，系统会自动替换为对应的数据：

| 占位符 | 说明 | 适用类型 |
|--------|------|----------|
| `{{supplier_name}}` | 供应商名称 | 采购对账单 |
| `{{purchaser_name}}` | 采购方/客户名称 | 销售对账单 |
| `{{start_date}}` | 对账单开始日期 | 两者均可 |
| `{{end_date}}` | 对账单结束日期 | 两者均可 |
| `{{bill_amount}}` | 账单金额 | 两者均可 |
| `{{statement_amount}}` | 结算金额 | 两者均可 |

### 3.2 列表数据占位符

用于填充采购/销售明细列表：

| 占位符 | 说明 | 适用类型 |
|--------|------|----------|
| `{{product_name}}` | 产品名称 | 两者均可 |
| `{{customer_product_name}}` | 客户产品名称 | 两者均可 |
| `{{purchase_date}}` | 采购日期 | 采购对账单 |
| `{{sale_date}}` | 销售日期 | 销售对账单 |
| `{{total_num}}` | 数量 | 两者均可 |
| `{{total_num}}` | 重量（公斤） | 两者均可 |
| `{{total_price}}` | 总金额 | 两者均可 |
| `{{product_spec}}` | 产品规格 | 两者均可 |
| `{{remark}}` | 备注 | 两者均可 |
| `{{unit_price}}` | 单价 | 两者均可 |

## 四、列表数据标记

### 4.1 基本用法

在模板中，需要填充列表数据的行，必须在任意单元格中包含 `<list_data>` 标记。

**示例：**
```
| 产品名称 | 规格 | 数量 | 金额 | <list_data> |
```

### 4.2 指定固定行数

可以使用 `<list_data:N>` 格式指定至少保留 N 行，即使数据不足 N 行也会保留空行。

**示例：**
```
| 产品名称 | 规格 | 数量 | 金额 | <list_data:10> |
```
表示至少保留 10 行数据。

## 五、样式规范

### 5.1 样式继承

- 标记为 `<list_data>` 的行作为模板行
- 新插入的行会自动复制模板行的所有样式，包括：
  - 字体样式
  - 边框样式
  - 单元格填充
  - 对齐方式
  - 数字格式

### 5.2 合并单元格

- 支持合并单元格
- 合并单元格中的占位符会被正确替换
- 建议在基本信息区域使用合并单元格

## 六、日期处理

- 如果数据中 `end_date` 为空，系统会自动使用当前日期
- 日期格式统一为：`YYYY-MM-DD`

## 七、模板制作流程

1. 创建一个新的 Excel 文件
2. 设计表格布局，包括基本信息区域和列表数据区域
3. 在基本信息区域使用 `{{占位符}}` 标记需要替换的内容
4. 在列表数据区域的第一行（模板行）使用 `<list_data>` 标记
5. 在列表数据行中使用列表数据占位符
6. 设置好所有单元格样式
7. 按照命名规则保存文件到对应的目录

## 八、示例模板结构

### 采购对账单模板示例：

```
┌─────────────────────────────────────────────────┐
│                    采购对账单                     │
├──────────────┬──────────────────────────────────┤
│ 供应商名称   │ {{supplier_name}}                │
├──────────────┼──────────────────────────────────┤
│ 对账单期间   │ {{start_date}} 至 {{end_date}}   │
├──────────────┼──────────────────────────────────┤
│ 账单金额     │ {{bill_amount}}                  │
├──────────────┼──────────────────────────────────┤
│ 结算金额     │ {{statement_amount}}             │
└──────────────┴──────────────────────────────────┘

┌──────────┬────────┬──────┬──────┬────────┐
│ 产品名称 │ 规格   │ 数量 │ 重量 │ 金额   │ <list_data>
├──────────┼────────┼──────┼──────┼────────┤
│ {{product_name}} │ {{product_spec}} │ {{total_num}} │ {{total_num}} │ {{total_price}} │
└──────────┴────────┴──────┴──────┴────────┘
```
