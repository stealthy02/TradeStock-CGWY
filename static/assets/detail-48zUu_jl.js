import{d as F,az as C,O as $,c as z,h as s,a as i,f as l,i as o,e as I,ad as M,s as Q,ax as j,b as d,ae as R,o as p,F as O,k as A,ac as U,t as u,am as g,ag as G,g as K,aC as E,ap as W,B as X}from"./.pnpm-B0XLMEKp.js";import{g as Y,c as Z}from"./inventory-QY7kwVo4.js";import{s as ee}from"./purchase-D8MZpE6K.js";import{_ as ae}from"./index-CnvvL9sG.js";import"./request-DINYhP-L.js";var _=(v=>(v.PURCHASE_IN="采购入库",v.SALE_OUT="销售出库",v.LOSS="库存报损",v))(_||{});const te={class:"page-container"},ne={class:"product-select-bar"},se={class:"info-item"},oe={class:"info-value"},le={class:"info-item"},re={class:"info-value"},ie={class:"info-item"},ce={class:"info-value"},de={class:"info-item"},ue={class:"info-value"},_e={class:"info-item"},pe={class:"info-value"},ve=F({__name:"detail",setup(v){const{Option:L}=C,S=K(),f=d([]),b=d([]),y=d(""),h=d(""),c=d(null),n=R({product_name:"",product_spec:"",page_num:1,page_size:10}),w=d([]),r=R({current:1,pageSize:10,total:0}),x=d(!1),N=async()=>{try{const e=await ee();Array.isArray(e.data)&&(f.value=e.data,f.value.length>0&&(y.value=f.value[0],P(f.value[0])))}catch(e){console.error("获取商品列表失败:",e)}},B=async e=>{try{const a=await Y();if(a.data.list){const t=a.data.list.filter(m=>m.product_name===e).map(m=>m.product_spec).filter((m,J,T)=>T.indexOf(m)===J);b.value=t,t.length>0?(h.value=t[0],n.product_spec=t[0],k()):(h.value="",n.product_spec="")}}catch(a){console.error("获取规格列表失败:",a),b.value=[]}},P=e=>{y.value=e,n.product_name=e,n.page_num=1,r.current=1,B(e)},V=()=>{n.product_spec=h.value,n.page_num=1,r.current=1,k()},k=async()=>{try{if(x.value=!0,!n.product_name||!n.product_spec){console.warn("商品名称和规格不能为空");return}const e=await Z({product_name:n.product_name,product_spec:n.product_spec,start_date:n.start_date,end_date:n.end_date,page_num:n.page_num,page_size:n.page_size});c.value=e.data.inventory_info,w.value=e.data.change_record.list,r.total=e.data.change_record.total}catch(e){console.error("获取库存详情失败:",e),w.value=[],r.total=0}finally{x.value=!1}},q=e=>{r.current=e,n.page_num=e,k()},D=(e,a)=>{r.pageSize=a,r.current=1,n.page_size=a,n.page_num=1,k()},H=[{title:"操作时间",dataIndex:"change_date",key:"change_date",sorter:!0},{title:"操作类型",dataIndex:"change_type",key:"change_type",customRender:({text:e})=>{let a="";switch(e){case _.PURCHASE_IN:a="green";break;case _.SALE_OUT:a="blue";break;case _.LOSS:a="red";break;default:a="default"}return{children:E(W,{color:a},()=>e)}}},{title:"关联单号",dataIndex:"related_id",key:"related_id"},{title:"变化量",dataIndex:"change_num",key:"change_num",customRender:({text:e})=>({children:`${e>0?"+":""}${e}`})},{title:"操作后库存量",dataIndex:"stock_after",key:"stock_after",customRender:({record:e})=>({children:e.stock_after||0})},{title:"操作来源",dataIndex:"remark",key:"remark",customRender:({text:e})=>({children:e||"-"})},{title:"操作跳转",dataIndex:"action",key:"action",customRender:({record:e})=>({children:E(X,{type:"link",size:"small",onClick:()=>{switch(e.change_type){case _.PURCHASE_IN:S.push({path:"/layout/purchase/info",query:{id:e.related_id}});break;case _.SALE_OUT:S.push({path:"/layout/sale/info",query:{id:e.related_id}});break;case _.LOSS:S.push({path:"/layout/inventory/loss",query:{id:e.related_id}});break}}},()=>"跳转")})}];return $(()=>{N()}),(e,a)=>(p(),z("div",te,[s("div",ne,[i(o(C),{value:y.value,"onUpdate:value":a[0]||(a[0]=t=>y.value=t),placeholder:"请选择商品",style:{width:"200px"},"show-search":"","option-filter-prop":"label",onChange:P},{default:l(()=>[(p(!0),z(O,null,A(f.value,t=>(p(),I(o(L),{key:t,value:t,label:t},{default:l(()=>[U(u(t),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value"]),i(o(C),{value:h.value,"onUpdate:value":a[1]||(a[1]=t=>h.value=t),placeholder:"请选择商品规格",style:{width:"180px","margin-left":"16px"},onChange:V},{default:l(()=>[(p(!0),z(O,null,A(b.value,t=>(p(),I(o(L),{key:t,value:t,label:t},{default:l(()=>[U(u(t),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value"])]),c.value?(p(),I(o(M),{key:0,class:"info-card"},{default:l(()=>[i(o(G),{gutter:[16,16]},{default:l(()=>[i(o(g),{span:6},{default:l(()=>[s("div",se,[a[2]||(a[2]=s("div",{class:"info-label"},"商品名称",-1)),s("div",oe,u(c.value.product_name),1)])]),_:1}),i(o(g),{span:6},{default:l(()=>[s("div",le,[a[3]||(a[3]=s("div",{class:"info-label"},"商品规格",-1)),s("div",re,u(c.value.product_spec),1)])]),_:1}),i(o(g),{span:6},{default:l(()=>[s("div",ie,[a[4]||(a[4]=s("div",{class:"info-label"},"当前库存数量",-1)),s("div",ce,u(c.value.inventory_num),1)])]),_:1}),i(o(g),{span:6},{default:l(()=>[s("div",de,[a[5]||(a[5]=s("div",{class:"info-label"},"库存单位成本",-1)),s("div",ue,u(c.value.inventory_cost),1)])]),_:1}),i(o(g),{span:6},{default:l(()=>[s("div",_e,[a[6]||(a[6]=s("div",{class:"info-label"},"当前库存价值",-1)),s("div",pe,u(c.value.inventory_value),1)])]),_:1})]),_:1})]),_:1})):Q("",!0),i(o(j),{columns:H,"data-source":w.value,"row-key":t=>t.id,pagination:{current:r.current,pageSize:r.pageSize,total:r.total,showSizeChanger:!0,showQuickJumper:!0,onChange:q,onShowSizeChange:D},class:"flow-table",loading:x.value},null,8,["data-source","row-key","pagination","loading"])]))}}),ke=ae(ve,[["__scopeId","data-v-eb3f9cba"]]);export{ke as default};
