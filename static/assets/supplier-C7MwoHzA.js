import{d as ke,O as we,V as u,c as D,a,f as n,h as o,e as w,s as q,b as r,ae as I,af as xe,ag as Ce,ah as Se,ai as ze,aj as Ae,o as c,ak as De,al as Fe,B as Ue,ac as i,am as Be,i as G,a9 as Ve,F as Me,k as $e,an as Le,ao as Ne,t as g,ap as qe,aq as H,ad as Ie,ar as Oe,as as Re,at as je,au as Ee,av as Te,r as Pe,aw as Ke}from"./.pnpm-B0XLMEKp.js";import{g as Qe,u as We,a as Ge,d as He}from"./basic-Com0UItg.js";import{_ as Je}from"./index-CnvvL9sG.js";import"./request-DINYhP-L.js";const Xe={class:"page-container"},Ye={class:"supplier-container"},Ze={class:"card-header"},ea={class:"card-body"},aa={class:"info-item"},ta={class:"value"},la={class:"info-item"},na={class:"value"},oa={class:"info-item"},sa={class:"value"},ra=["title"],ua={class:"value"},ia=["title"],pa={class:"value"},da={class:"info-item"},ca={class:"value"},_a={class:"card-actions"},ma={style:{"text-align":"right","margin-top":"16px"}},va=["src"],ga={key:1},fa={style:{"text-align":"right","margin-top":"16px"}},ha="https://gw.alipayobjects.com/zos/rmsportal/BiazfanxmamNRoxxVxka.png",ya="/api/upload/avatar",ba=ke({__name:"supplier",setup(ka){const y=r(!1),F=r(!1),_=r([]),C=r(""),b=r(1),U=r(10),B=r(0),V=r([]),M=r(!1),f=I({page_num:1,page_size:10,supplier_name:"",contact_phone:""}),S=r(!1),m=r(!1),O=r(null),s=I({id:0,supplier_name:"",contact_person:"",contact_phone:"",company_address:"",bank_name:"",bank_account:"",tax_no:"",remark:"",avatar_url:""}),z=r([]),A=r(!1),$=r(""),x=r(0),J=I({supplier_name:[{type:"string",required:!0,message:"请输入供货商名",trigger:"blur"},{type:"string",min:2,max:50,message:"名称长度2-50字符",trigger:"blur"}],contact_person:[{type:"string",required:!1,message:"请输入联系人",trigger:"blur"},{type:"string",min:1,max:20,message:"联系人长度1-20字符",trigger:"blur"}],contact_phone:[{type:"string",required:!1,message:"请输入联系电话",trigger:"blur"},{type:"string",pattern:/^(1[3-9]\d{9})$|^(\d{3,4}-)?\d{7,8}$/,message:"请输入合法手机号/固话",trigger:"blur"}]});we(()=>{h()});const h=async()=>{y.value=!0;try{const l={page_num:b.value,page_size:U.value,supplier_name:C.value||f.supplier_name,contact_phone:f.contact_phone},e=await Qe(l);console.log("原始接口数据：",e.data),e.code===200?(V.value=e.data.list,B.value=e.data.total):u.error(e.message||"获取列表失败")}catch(l){console.error("获取列表异常：",l),u.error("网络异常，获取列表失败")}finally{y.value=!1}},X=l=>{b.value=l,h()},Y=(l,e)=>{U.value=e,b.value=1,h()},Z=()=>{b.value=1,h()},ee=()=>M.value=!0,R=()=>M.value=!1,ae=()=>{f.supplier_name="",f.contact_phone=""},te=()=>{R(),b.value=1,C.value="",h()},j=()=>{m.value=!1,S.value=!0,T()},E=l=>{m.value=!0,S.value=!0,T(),Object.assign(s,l),l.avatar_url&&(z.value=[{uid:`${l.id}_avatar`,name:"avatar.png",url:l.avatar_url}])},L=()=>{S.value=!1,z.value=[]},T=()=>{var l;(l=O.value)==null||l.resetFields(),Object.assign(s,{id:0,supplier_name:"",contact_person:"",contact_phone:"",company_address:"",bank_name:"",bank_account:"",tax_no:"",remark:"",avatar_url:""})},le=l=>{const e=l.type.startsWith("image/"),k=l.size/1024/1024<2;return e||u.error("请上传图片格式文件"),k||u.error("图片大小不超过2MB"),e&&k},ne=l=>{if(l.file.status==="done"){const e=l.file.response;e.code===200&&(s.avatar_url=e.data.url,z.value=[{uid:l.file.uid,name:l.file.name||"avatar.png",url:e.data.url}],u.success("头像上传成功"))}else l.file.status==="error"&&u.error("头像上传失败")},oe=async()=>{F.value=!0;try{let l;if(m.value)l=await We(s);else{const{id:e,...k}=s;l=await Ge(k)}l.code===200?(u.success(m.value?"修改成功":"新增成功"),L(),h()):u.error(l.message||(m.value?"修改失败":"新增失败"))}catch(l){console.error("提交异常：",l),u.error(m.value?"修改失败":"新增失败")}finally{F.value=!1}},se=l=>{x.value=l,$.value="确定删除该供货商吗？删除后不可恢复！",A.value=!0},re=()=>{x.value=_.value,$.value=`确定删除选中的${_.value.length}个供货商吗？`,A.value=!0},P=()=>A.value=!1,ue=async()=>{y.value=!0;try{const l=Array.isArray(x.value)?x.value:[x.value];await Promise.all(l.map(e=>He({id:e}))),u.success("删除成功"),P(),_.value=[],h()}catch(l){console.error("删除异常：",l),u.error("删除失败")}finally{y.value=!1}};return(l,e)=>{const k=Fe,p=Ue,ie=De,pe=xe,de=Ke,K=Be,ce=Le,_e=Ne,me=qe,ve=Ce,ge=Se,v=je,d=Re,Q=Oe,W=ze,fe=Pe("a-icon"),he=Ee,ye=Te,be=Ae;return c(),D("div",Xe,[a(pe,{title:"供货商信息管理",breadcrumb:{routes:[{path:"",name:"基础信息管理"},{path:"",name:"供货商信息"}]},style:{"margin-bottom":"20px"}},{extra:n(()=>[a(ie,{size:"middle"},{default:n(()=>[a(k,{value:C.value,"onUpdate:value":e[0]||(e[0]=t=>C.value=t),placeholder:"请输入供货商名模糊搜索","allow-clear":"",style:{width:"300px"},onSearch:Z},null,8,["value"]),a(p,{type:"default",icon:"search",onClick:ee},{default:n(()=>[...e[10]||(e[10]=[i(" 高级搜索 ",-1)])]),_:1}),a(p,{type:"primary",icon:"plus",onClick:j},{default:n(()=>[...e[11]||(e[11]=[i(" 新增供货商 ",-1)])]),_:1}),a(p,{type:"default",danger:"",icon:"delete",disabled:_.value.length===0,onClick:re},{default:n(()=>[...e[12]||(e[12]=[i(" 批量删除 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),o("div",Ye,[y.value?(c(),w(de,{key:0,active:!0,style:{width:"100%"}})):(c(),w(ve,{key:1,gutter:[24,24]},{default:n(()=>[V.value.length===0?(c(),w(K,{key:0,span:24},{default:n(()=>[a(G(Ve),{description:"暂无供货商信息，点击右上角「新增供货商」添加",style:{margin:"40px 0"}},{default:n(()=>[a(p,{type:"primary",icon:"plus",onClick:j},{default:n(()=>[...e[13]||(e[13]=[i(" 新增供货商 ",-1)])]),_:1})]),_:1})]),_:1})):q("",!0),(c(!0),D(Me,null,$e(V.value,t=>(c(),w(K,{span:8,key:t.id},{default:n(()=>[a(G(Ie),{class:"supplier-card",hoverable:"",bordered:!1,onClick:()=>E(t)},{default:n(()=>[o("div",Ze,[a(ce,{checked:_.value.includes(t.id),onChange:N=>N.target.checked?_.value.push(t.id):_.value.splice(_.value.indexOf(t.id),1),style:{"margin-right":"12px"}},null,8,["checked","onChange"]),a(_e,{src:t.avatar_url||ha,size:64,class:"supplier-avatar"},null,8,["src"])]),o("div",ea,[o("div",aa,[e[14]||(e[14]=o("span",{class:"label"},"供货商名：",-1)),o("span",ta,g(t.supplier_name),1)]),o("div",la,[e[15]||(e[15]=o("span",{class:"label"},"联系人：",-1)),o("span",na,g(t.contact_person),1)]),o("div",oa,[e[16]||(e[16]=o("span",{class:"label"},"联系电话：",-1)),o("span",sa,g(t.contact_phone),1)]),o("div",{class:"info-item ellipsis",title:t.company_address||"未填写"},[e[17]||(e[17]=o("span",{class:"label"},"公司地址：",-1)),o("span",ua,g(t.company_address||"未填写"),1)],8,ra),o("div",{class:"info-item ellipsis",title:t.bank_name||"未填写"},[e[18]||(e[18]=o("span",{class:"label"},"开户行：",-1)),o("span",pa,g(t.bank_name||"未填写"),1)],8,ia),o("div",da,[e[19]||(e[19]=o("span",{class:"label"},"创建时间：",-1)),o("span",ca,g(t.create_time),1)]),t.remark?(c(),w(me,{key:0,color:"blue",title:t.remark},{default:n(()=>[...e[20]||(e[20]=[i(" 有备注 ",-1)])]),_:1},8,["title"])):q("",!0)]),o("div",_a,[a(p,{type:"text",onClick:H(N=>E(t),["stop"])},{default:n(()=>[...e[21]||(e[21]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(p,{type:"text",danger:"",onClick:H(N=>se(t.id),["stop"])},{default:n(()=>[...e[22]||(e[22]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),B.value>0?(c(),w(ge,{key:2,current:b.value,"page-size":U.value,total:B.value,"show-total":t=>`共 ${t} 条记录`,"show-size-changer":"",style:{"margin-top":"24px","text-align":"right"},onChange:X,onShowSizeChange:Y},null,8,["current","page-size","total","show-total"])):q("",!0)]),a(W,{title:"高级搜索",open:M.value,width:"400px",onClose:R},{default:n(()=>[a(Q,{model:f,layout:"vertical",onFinish:te},{default:n(()=>[a(d,{label:"税号",name:"tax_no"},{default:n(()=>[a(v,{value:s.tax_no,"onUpdate:value":e[1]||(e[1]=t=>s.tax_no=t),placeholder:"请输入税号","allow-clear":"",maxlength:50,"show-word-limit":""},null,8,["value"])]),_:1}),a(d,{label:"联系电话",name:"contact_phone"},{default:n(()=>[a(v,{value:f.contact_phone,"onUpdate:value":e[2]||(e[2]=t=>f.contact_phone=t),placeholder:"请输入联系电话","allow-clear":""},null,8,["value"])]),_:1}),o("div",ma,[a(p,{type:"default",onClick:ae,style:{"margin-right":"8px"}},{default:n(()=>[...e[23]||(e[23]=[i(" 重置 ",-1)])]),_:1}),a(p,{type:"primary","html-type":"submit"},{default:n(()=>[...e[24]||(e[24]=[i(" 查询 ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1},8,["open"]),a(W,{title:m.value?"编辑供货商":"新增供货商",open:S.value,width:"600px","destroy-on-close":"",onClose:L},{default:n(()=>[a(Q,{ref_key:"supplierFormRef",ref:O,model:s,rules:J,layout:"vertical",onFinish:oe},{default:n(()=>[a(d,{label:"供货商头像",name:"avatar_url"},{default:n(()=>[a(he,{action:ya,"list-type":"picture-card","file-list":z.value,"before-upload":le,onChange:ne,"show-upload-list":!1},{default:n(()=>[s.avatar_url?(c(),D("img",{key:0,src:s.avatar_url,width:"100",height:"100"},null,8,va)):(c(),D("div",ga,[a(fe,{type:y.value?"loading":"plus"},null,8,["type"]),e[25]||(e[25]=o("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),a(d,{label:"供货商名",name:"supplier_name"},{default:n(()=>[a(v,{value:s.supplier_name,"onUpdate:value":e[3]||(e[3]=t=>s.supplier_name=t),placeholder:"请输入供货商名","allow-clear":"",maxlength:50,"show-word-limit":""},null,8,["value"])]),_:1}),a(d,{label:"联系人",name:"contact_person"},{default:n(()=>[a(v,{value:s.contact_person,"onUpdate:value":e[4]||(e[4]=t=>s.contact_person=t),placeholder:"请输入联系人","allow-clear":"",maxlength:20,"show-word-limit":""},null,8,["value"])]),_:1}),a(d,{label:"联系电话",name:"contact_phone"},{default:n(()=>[a(v,{value:s.contact_phone,"onUpdate:value":e[5]||(e[5]=t=>s.contact_phone=t),placeholder:"请输入手机号/固话","allow-clear":"",maxlength:20},null,8,["value"])]),_:1}),a(d,{label:"公司地址",name:"address"},{default:n(()=>[a(v,{value:s.company_address,"onUpdate:value":e[6]||(e[6]=t=>s.company_address=t),placeholder:"请输入公司地址","allow-clear":"",maxlength:200,"show-word-limit":""},null,8,["value"])]),_:1}),a(d,{label:"开户行",name:"bank_name"},{default:n(()=>[a(v,{value:s.bank_name,"onUpdate:value":e[7]||(e[7]=t=>s.bank_name=t),placeholder:"请输入开户行","allow-clear":"",maxlength:50,"show-word-limit":""},null,8,["value"])]),_:1}),a(d,{label:"银行账号",name:"bank_account"},{default:n(()=>[a(v,{value:s.bank_account,"onUpdate:value":e[8]||(e[8]=t=>s.bank_account=t),placeholder:"请输入银行账号","allow-clear":"",maxlength:30,"show-word-limit":""},null,8,["value"])]),_:1}),a(d,{label:"备注",name:"remark"},{default:n(()=>[a(ye,{value:s.remark,"onUpdate:value":e[9]||(e[9]=t=>s.remark=t),placeholder:"请输入备注","allow-clear":"",rows:3,maxlength:200,"show-word-limit":""},null,8,["value"])]),_:1}),o("div",fa,[a(p,{type:"default",onClick:L,style:{"margin-right":"8px"}},{default:n(()=>[...e[26]||(e[26]=[i(" 取消 ",-1)])]),_:1}),a(p,{type:"primary","html-type":"submit",loading:F.value},{default:n(()=>[i(g(m.value?"保存修改":"新增"),1)]),_:1},8,["loading"])])]),_:1},8,["model","rules"])]),_:1},8,["title","open"]),a(be,{title:"确认删除",open:A.value,onOk:ue,onCancel:P,"ok-text":"确认删除","cancel-text":"取消","ok-type":"danger"},{default:n(()=>[o("p",null,g($.value),1)]),_:1},8,["open"])])}}}),za=Je(ba,[["__scopeId","data-v-d547e461"]]);export{za as default};
