import{d as H,ae as D,I as y,O as J,c as K,h as Q,a as t,f as a,e as W,s as Z,b as c,U as ee,V as x,B as te,ar as ae,an as oe,ax as le,aj as k,o as h,ac as r,i as ne,ay as se,at as re,az as ue,aF as de,X as ie,as as fe,aA as pe,aB as me,av as _e,aC as v,aD as ce,aE as ge}from"./.pnpm-B0XLMEKp.js";import{r as b}from"./request-DINYhP-L.js";import{_ as ve}from"./index-CnvvL9sG.js";const ye=p=>b({url:"/cost/fee/add",method:"post",data:p}),xe=p=>b({url:"/cost/fee/list",method:"get",params:p}),ke=p=>b({url:"/cost/fee/update",method:"put",data:p}),be=p=>b({url:"/cost/fee/delete",method:"delete",params:p}),we={class:"page-container"},Ce=H({__name:"fee",setup(p){const _=c(!1),w=c("新增运营杂费"),C=c(!0),i=c([]),M=c([]),R=c(0),Y=c(!1),u=D({page_num:1,page_size:10}),n=D({fee_desc:"",fee_amount:0,fee_date:y(),fee_type:"其他",remark:""}),U=D({fee_desc:[{required:!0,message:"请输入费用描述",trigger:["blur","change"]},{type:"string",min:1,max:50,message:"费用描述长度1-50字符",trigger:["blur","change"]}],fee_amount:[{required:!0,message:"请输入费用金额",trigger:["blur","change"]},{type:"number",min:.01,message:"费用金额必须为正数",trigger:["blur","change"]}],fee_date:[{required:!0,message:"请选择费用日期",trigger:["change"]}],fee_type:[{required:!0,message:"请选择费用类型",trigger:["change"]}]}),O=ee(()=>[{title:"费用描述",dataIndex:"fee_desc",key:"fee_desc",sorter:!0,ellipsis:!0,width:200},{title:"费用金额",dataIndex:"fee_amount",key:"fee_amount",sorter:!0,ellipsis:!0,width:150,customRender:o=>o.record.fee_amount.toFixed(2)},{title:"费用日期",dataIndex:"fee_date",key:"fee_date",sorter:!0,ellipsis:!0,width:120},{title:"费用类型",dataIndex:"fee_type_text",key:"fee_type_text",sorter:!0,ellipsis:!0,width:120},{title:"备注",dataIndex:"remark",key:"remark",ellipsis:!0,width:100,customRender:o=>{const e=o.record.remark;if(!e)return"-";const d=e.length>4?e.substring(0,4)+"...":e;return v(ce,{title:e},{default:()=>d})}},{title:"创建时间",dataIndex:"create_time",key:"create_time",sorter:!0,ellipsis:!0,width:180},{title:"操作",key:"action",fixed:"right",width:120,customRender:({record:o})=>v("div",[v("span",{style:{display:"inline-block",padding:"2px 8px",backgroundColor:"#1890ff",color:"#fff",borderRadius:"2px",cursor:"pointer",marginRight:"8px",fontSize:"12px"},onClick:()=>j(o)},"改"),v("span",{style:{display:"inline-block",padding:"2px 8px",backgroundColor:"#ff4d4f",color:"#fff",borderRadius:"2px",cursor:"pointer",fontSize:"12px"},onClick:()=>V(o.id)},"删")])}]),m=async()=>{var o,e;Y.value=!0;try{const d={...u,start_date:i.value[0]?typeof((o=i.value[0])==null?void 0:o.format)=="function"?i.value[0].format("YYYY-MM-DD"):i.value[0]:void 0,end_date:i.value[1]?typeof((e=i.value[1])==null?void 0:e.format)=="function"?i.value[1].format("YYYY-MM-DD"):i.value[1]:void 0},g=await xe(d);M.value=g.data.list.map(s=>({id:s.id,fee_desc:s.expense_desc,fee_amount:parseFloat(s.expense_amount),fee_date:s.expense_date,fee_type:s.expense_type,fee_type_text:s.expense_type,remark:s.remark,create_time:s.create_time,update_time:s.update_time})),R.value=g.data.total}catch(d){console.error("获取运营杂费列表失败:",d),x.error("获取数据失败，请稍后重试")}finally{Y.value=!1}},I=o=>{u.page_num=o,m()},F=(o,e)=>{u.page_size=e,u.page_num=1,m()},B=()=>{u.page_num=1,u.page_size=10,u.fee_desc="",u.fee_type=void 0,i.value=[],m()},P=()=>{Object.assign(n,{id:void 0,fee_desc:"",fee_amount:0,fee_date:y(),fee_type:"其他",remark:""}),w.value="新增运营杂费",_.value=!0},j=o=>{Object.assign(n,{id:o.id,fee_desc:o.fee_desc,fee_amount:o.fee_amount,fee_date:y(o.fee_date),fee_type:o.fee_type,remark:o.remark||""}),w.value="修改运营杂费",_.value=!0},q=async()=>{try{const o={...n,fee_date:typeof n.fee_date=="object"&&n.fee_date!==null&&typeof n.fee_date.format=="function"?n.fee_date.format("YYYY-MM-DD"):void 0};n.id?(await ke(o),x.success("操作成功"),_.value=!1,m()):(await ye(o),x.success("操作成功"),_.value=!1,m())}catch(o){console.error("提交失败:",o),k.error({title:"操作失败",content:o.message||"服务器错误，请稍后重试"})}},T=()=>{n.id||Object.assign(n,{fee_desc:"",fee_amount:0,fee_date:y(),fee_type:"其他",remark:""})},V=o=>{k.confirm({title:"确认删除",icon:()=>v(ge),content:"删除后不可恢复",okText:"确认",cancelText:"取消",onOk:async()=>{try{await be({id:o}),x.success("删除成功"),m()}catch(e){console.error("删除失败:",e),k.error({title:"删除失败",content:e.message||"服务器错误，请稍后重试"})}}})};return J(()=>{m()}),(o,e)=>{const d=te,g=re,s=fe,f=de,S=ue,E=ie,z=ae,N=oe,L=le,A=pe,$=me,X=_e,G=k;return h(),K("div",we,[e[28]||(e[28]=Q("h1",null,"运营杂费录入/查询",-1)),t(d,{type:"primary",style:{"margin-bottom":"16px"},onClick:P},{icon:a(()=>[t(ne(se))]),default:a(()=>[e[11]||(e[11]=r(" 新增运营杂费 ",-1))]),_:1}),C.value?(h(),W(z,{key:0,model:u,layout:"inline",style:{"margin-bottom":"16px"}},{default:a(()=>[t(s,{label:"费用描述"},{default:a(()=>[t(g,{value:u.fee_desc,"onUpdate:value":e[0]||(e[0]=l=>u.fee_desc=l),placeholder:"请输入费用描述",style:{width:"200px"}},null,8,["value"])]),_:1}),t(s,{label:"费用类型"},{default:a(()=>[t(S,{value:u.fee_type,"onUpdate:value":e[1]||(e[1]=l=>u.fee_type=l),placeholder:"请选择费用类型",style:{width:"150px"}},{default:a(()=>[t(f,{value:"房租"},{default:a(()=>[...e[12]||(e[12]=[r("房租",-1)])]),_:1}),t(f,{value:"水电"},{default:a(()=>[...e[13]||(e[13]=[r("水电",-1)])]),_:1}),t(f,{value:"人工"},{default:a(()=>[...e[14]||(e[14]=[r("人工",-1)])]),_:1}),t(f,{value:"物流"},{default:a(()=>[...e[15]||(e[15]=[r("物流",-1)])]),_:1}),t(f,{value:"其他"},{default:a(()=>[...e[16]||(e[16]=[r("其他",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(s,{label:"日期范围"},{default:a(()=>[t(E,{value:i.value,"onUpdate:value":e[2]||(e[2]=l=>i.value=l),format:"YYYY-MM-DD",style:{width:"300px"}},null,8,["value"])]),_:1}),t(s,null,{default:a(()=>[t(d,{type:"primary",onClick:m},{default:a(()=>[...e[17]||(e[17]=[r("查询",-1)])]),_:1}),t(d,{style:{"margin-left":"8px"},onClick:B},{default:a(()=>[...e[18]||(e[18]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])):Z("",!0),t(N,{checked:C.value,"onUpdate:checked":e[3]||(e[3]=l=>C.value=l),style:{"margin-bottom":"16px"}},{default:a(()=>[...e[19]||(e[19]=[r("显示搜索栏",-1)])]),_:1},8,["checked"]),t(L,{columns:O.value,"data-source":M.value,"row-key":l=>l.id,pagination:{showSizeChanger:!0,pageSizeOptions:[10,20,50,100],showTotal:l=>`共 ${l} 条记录`,current:u.page_num,pageSize:u.page_size,onChange:I,onShowSizeChange:F},scroll:{x:1200},loading:Y.value},null,8,["columns","data-source","row-key","pagination","loading"]),t(G,{open:_.value,"onUpdate:open":e[10]||(e[10]=l=>_.value=l),title:w.value,width:"600px",destroyOnClose:"",footer:null},{default:a(()=>[t(z,{model:n,rules:U,layout:"vertical"},{default:a(()=>[t(s,{label:"费用描述",name:"fee_desc"},{default:a(()=>[t(g,{value:n.fee_desc,"onUpdate:value":e[4]||(e[4]=l=>n.fee_desc=l),placeholder:"请输入费用描述（≤50字）",maxLength:50,"show-word-limit":""},null,8,["value"])]),_:1}),t(s,{label:"费用金额",name:"fee_amount"},{default:a(()=>[t(A,{value:n.fee_amount,"onUpdate:value":e[5]||(e[5]=l=>n.fee_amount=l),min:.01,step:.01,precision:2,placeholder:"请输入费用金额",style:{width:"100%"}},null,8,["value"])]),_:1}),t(s,{label:"费用日期",name:"fee_date"},{default:a(()=>[t($,{value:n.fee_date,"onUpdate:value":e[6]||(e[6]=l=>n.fee_date=l),format:"YYYY-MM-DD",style:{width:"100%"}},null,8,["value"])]),_:1}),t(s,{label:"费用类型",name:"fee_type"},{default:a(()=>[t(S,{value:n.fee_type,"onUpdate:value":e[7]||(e[7]=l=>n.fee_type=l),placeholder:"请选择费用类型",style:{width:"100%"}},{default:a(()=>[t(f,{value:"房租"},{default:a(()=>[...e[20]||(e[20]=[r("房租",-1)])]),_:1}),t(f,{value:"水电"},{default:a(()=>[...e[21]||(e[21]=[r("水电",-1)])]),_:1}),t(f,{value:"人工"},{default:a(()=>[...e[22]||(e[22]=[r("人工",-1)])]),_:1}),t(f,{value:"物流"},{default:a(()=>[...e[23]||(e[23]=[r("物流",-1)])]),_:1}),t(f,{value:"其他"},{default:a(()=>[...e[24]||(e[24]=[r("其他",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(s,{label:"备注",name:"remark"},{default:a(()=>[t(X,{value:n.remark,"onUpdate:value":e[8]||(e[8]=l=>n.remark=l),rows:4,maxLength:200,placeholder:"请输入备注信息"},null,8,["value"])]),_:1}),t(s,{style:{"margin-top":"24px"}},{default:a(()=>[t(d,{type:"primary",onClick:q},{default:a(()=>[...e[25]||(e[25]=[r("提交",-1)])]),_:1}),t(d,{style:{"margin-left":"8px"},onClick:T},{default:a(()=>[...e[26]||(e[26]=[r("重置",-1)])]),_:1}),t(d,{style:{"margin-left":"8px"},onClick:e[9]||(e[9]=l=>_.value=!1)},{default:a(()=>[...e[27]||(e[27]=[r("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","title"])])}}}),Se=ve(Ce,[["__scopeId","data-v-2ea68f50"]]);export{Se as default};
