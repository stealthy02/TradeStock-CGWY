import{d as F,Q as I,O as Q,c as w,h as a,a as s,F as G,k as H,f as o,e as u,s as W,i as Y,T as $,b as p,U as P,V as S,W as Z,X as J,Y as K,Z as ee,$ as te,a0 as ae,a1 as se,a2 as re,a3 as oe,a4 as le,a5 as ne,a6 as ie,a7 as ue,a8 as de,o as l,a9 as ce,aa as pe,ab as ve,ac as d,I as T,ad as me}from"./.pnpm-B0XLMEKp.js";import{r as D}from"./request-DINYhP-L.js";import{_ as fe}from"./index-CnvvL9sG.js";const he=v=>D({url:"/home/statistic-card",method:"get",params:v}),_e=v=>D({url:"/home/pie-chart",method:"get",params:v}),ye=v=>D({url:"/home/trend-chart",method:"get",params:v}),ge={class:"home-container"},Ce={class:"stat-card-wrap"},ke={key:0,class:"stat-empty"},xe={class:"chart-card single-chart"},be={class:"chart-header"},we={class:"pie-chart-wrap"},Ye={class:"chart-card pie-chart"},$e={class:"chart-header"},Pe={class:"chart-card pie-chart"},Te={class:"chart-header"},De=F({__name:"home",setup(v){I([K,ee,te,ae,se,re,oe,le,ne,ie,ue,de]);const m=p("year"),_=p("all"),c=p(void 0),y=p({}),f=p([]),B=P(()=>({tooltip:{trigger:"axis",formatter:function(e){let t=e[0].name+"<br/>";return e.forEach(r=>{t+=`${r.marker}${r.seriesName}: ${r.value} 元<br/>`}),t}},legend:{data:["营收","支出"],top:0},grid:{left:"3%",right:"4%",bottom:"3%",outerBounds:{left:"3%",right:"4%",bottom:"3%",top:"10%"}},xAxis:{type:"category",boundaryGap:!1,data:f.value.map(e=>e.date)},yAxis:{type:"value",axisLabel:{formatter:"{value} 元"}},series:[{name:"营收",type:"line",smooth:!0,data:f.value.map(e=>e.营收),itemStyle:{color:"#1890ff"}},{name:"支出",type:"line",smooth:!0,data:f.value.map(e=>e.支出),itemStyle:{color:"#ff4d4f"}}]})),g=p([]),C=p([]),M=P(()=>({tooltip:{trigger:"item",formatter:"{b}: {c} 元 ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{name:"采购商利润",type:"pie",radius:"70%",center:["50%","50%"],data:g.value.map(e=>({value:e.value,name:e.name})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})),R=P(()=>({tooltip:{trigger:"item",formatter:"{b}: {c} 元 ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{name:"商品利润",type:"pie",radius:"70%",center:["50%","50%"],data:C.value.map(e=>({value:e.value,name:e.name})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})),U=e=>{const t={time_type:e};return e==="custom"&&c.value&&(t.start_date=c.value[0].format("YYYY-MM-DD"),t.end_date=c.value[1].format("YYYY-MM-DD")),t},N=e=>{y.value={inventory_value:{title:"当前库存总价值",value:e.inventory_value},purchase_unreceived:{title:"采购未结清总额",value:e.purchase_unreceived},sale_unreceived:{title:"销售未结清总额",value:e.sale_unreceived},month_profit:{title:"本月毛利",value:e.month_profit||e.cycle_profit||0},year_profit:{title:"本年毛利",value:e.year_profit||0},total_profit:{title:"总毛利",value:e.total_profit||0}}},V=e=>{const{xAxis:t,revenue_data:r,expend_data:b}=e,x=[];t.forEach((n,h)=>{x.push({date:n,营收:r[h]||0,支出:b[h]||0})}),f.value=x},E=e=>{g.value=e.purchaser_profit,C.value=e.product_profit},L=async()=>{try{const e=await he();N(e.data)}catch(e){y.value={},console.error("获取数据总览失败：",e)}},k=async()=>{try{const e=U(m.value),[t,r]=await Promise.all([_e(e),ye(e)]);E(t.data),V(r.data)}catch(e){f.value=[],g.value=[],C.value=[],console.error("获取图表数据失败：",e)}},A=async()=>{try{await Promise.all([L(),k()]),S.success("获取首页数据成功")}catch(e){console.error("获取首页数据失败：",e),S.error("获取首页数据失败，请稍后重试")}},X=()=>{if(m.value==="custom"&&!c.value){const e=T().year();c.value=[T().year(e).startOf("year"),T().year(e).endOf("year")]}k()},j=()=>{m.value==="custom"&&k()},O=()=>{k()};return Q(()=>{A()}),(e,t)=>{const r=ce,b=pe,x=me,n=ve,h=Z,q=J;return l(),w("div",ge,[t[15]||(t[15]=a("div",{class:"home-header"},[a("div",{class:"header-left"},[a("h2",null,"数据总览")])],-1)),a("div",Ce,[Object.keys(y.value).length===0?(l(),w("div",ke,[s(r,{description:"暂无数字卡片数据"})])):(l(!0),w(G,{key:1},H(y.value,(i,z)=>(l(),u(x,{key:z,class:"stat-card"},{default:o(()=>[s(b,{title:i.title,value:i.value,precision:2,suffix:"元"},null,8,["title","value"])]),_:2},1024))),128))]),a("div",xe,[a("div",be,[t[6]||(t[6]=a("h3",null,"营收支出趋势",-1)),s(h,{value:m.value,"onUpdate:value":t[0]||(t[0]=i=>m.value=i),onChange:X},{default:o(()=>[s(n,{value:"year"},{default:o(()=>[...t[4]||(t[4]=[d("本年",-1)])]),_:1}),s(n,{value:"custom"},{default:o(()=>[...t[5]||(t[5]=[d("自定义",-1)])]),_:1})]),_:1},8,["value"]),m.value==="custom"?(l(),u(q,{key:0,value:c.value,"onUpdate:value":t[1]||(t[1]=i=>c.value=i),onChange:j,style:{"margin-left":"12px"},format:"YYYY-MM",picker:"month"},null,8,["value"])):W("",!0)]),f.value.length?(l(),u(Y($),{key:1,option:B.value,style:{width:"100%",height:"400px"}},null,8,["option"])):(l(),u(r,{key:0,description:"暂无营收支出趋势数据"}))]),a("div",we,[a("div",Ye,[a("div",$e,[t[10]||(t[10]=a("h3",null,"采购商利润分布",-1)),s(h,{value:_.value,"onUpdate:value":t[2]||(t[2]=i=>_.value=i),onChange:O,size:"small"},{default:o(()=>[s(n,{value:"all"},{default:o(()=>[...t[7]||(t[7]=[d("全部",-1)])]),_:1}),s(n,{value:"year"},{default:o(()=>[...t[8]||(t[8]=[d("本年",-1)])]),_:1}),s(n,{value:"month"},{default:o(()=>[...t[9]||(t[9]=[d("本月",-1)])]),_:1})]),_:1},8,["value"])]),g.value.length?(l(),u(Y($),{key:1,option:M.value,style:{width:"100%",height:"300px"}},null,8,["option"])):(l(),u(r,{key:0,description:"暂无采购商利润数据"}))]),a("div",Pe,[a("div",Te,[t[14]||(t[14]=a("h3",null,"商品利润分布",-1)),s(h,{value:_.value,"onUpdate:value":t[3]||(t[3]=i=>_.value=i),onChange:O,size:"small"},{default:o(()=>[s(n,{value:"all"},{default:o(()=>[...t[11]||(t[11]=[d("全部",-1)])]),_:1}),s(n,{value:"year"},{default:o(()=>[...t[12]||(t[12]=[d("本年",-1)])]),_:1}),s(n,{value:"month"},{default:o(()=>[...t[13]||(t[13]=[d("本月",-1)])]),_:1})]),_:1},8,["value"])]),C.value.length?(l(),u(Y($),{key:1,option:R.value,style:{width:"100%",height:"300px"}},null,8,["option"])):(l(),u(r,{key:0,description:"暂无商品利润数据"}))])])])}}}),Me=fe(De,[["__scopeId","data-v-449b7ed4"]]);export{Me as default};
