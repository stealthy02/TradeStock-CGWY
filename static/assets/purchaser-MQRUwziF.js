import{d as we,O as xe,V as d,c as A,a,f as n,h as o,e as w,s as N,b as r,ae as q,af as Ce,ag as Se,ah as ze,ai as Ue,aj as Ae,o as _,ak as De,al as Fe,B as Be,ac as i,am as Ve,i as H,a9 as Me,F as Pe,k as $e,an as Le,aq as I,ao as Ne,t as f,ap as qe,ad as Ie,ar as Oe,as as Re,at as je,au as Ee,av as Te,r as Ke,aw as Qe}from"./.pnpm-B0XLMEKp.js";import{b as We,c as Ge,e as He,f as Je}from"./basic-Com0UItg.js";import{_ as Xe}from"./index-CnvvL9sG.js";import"./request-DINYhP-L.js";const Ye={class:"page-container"},Ze={class:"purchaser-container"},ea={class:"card-header"},aa={class:"card-body"},ta={class:"info-item"},la={class:"value"},na={class:"info-item"},sa={class:"value"},oa={class:"info-item"},ra={class:"value"},ua=["title"],da={class:"value"},ia=["title"],ca={class:"value"},pa={class:"info-item"},_a={class:"value"},va={class:"card-actions"},ma={style:{"text-align":"right","margin-top":"16px"}},ga=["src"],fa={key:1},ha={style:{"text-align":"right","margin-top":"16px"}},J="https://gw.alipayobjects.com/zos/rmsportal/BiazfanxmamNRoxxVxka.png",ya="/api/upload/avatar",ba=we({__name:"purchaser",setup(ka){const y=r(!1),D=r(!1),m=r([]),C=r(""),b=r(1),F=r(10),B=r(0),V=r([]),M=r(!1),v=q({page_num:1,page_size:10,purchaser_name:"",contact_phone:""}),S=r(!1),g=r(!1),O=r(null),s=q({id:0,purchaser_name:"",contact_person:"",contact_phone:"",company_address:"",receive_address:"",bank_name:"",bank_account:"",tax_no:"",remark:"",avatar:""}),z=r([]),U=r(!1),P=r(""),x=r(0),X=q({purchaser_name:[{type:"string",required:!0,message:"请输入采购商名",trigger:"blur"},{type:"string",min:2,max:50,message:"名称长度2-50字符",trigger:"blur"}],contact_person:[{type:"string",required:!1,message:"请输入联系人",trigger:"blur"},{type:"string",min:1,max:20,message:"联系人长度1-20字符",trigger:"blur"}],contact_phone:[{type:"string",required:!1,message:"请输入联系电话",trigger:"blur"},{type:"string",pattern:/^(1[3-9]\d{9})$|^(\d{3,4}-)?\d{7,8}$/,message:"请输入合法手机号/固话",trigger:"blur"}]});xe(()=>{h()});const h=async()=>{y.value=!0;try{const l={page_num:b.value,page_size:F.value,purchaser_name:C.value||v.purchaser_name,contact_phone:v.contact_phone},e=await We(l);e.code===200?(V.value=e.data.list,B.value=e.data.total):d.error(e.message||"获取列表失败")}catch(l){console.error("获取列表异常：",l),d.error("网络异常，获取列表失败")}finally{y.value=!1}},Y=l=>{b.value=l,h()},Z=(l,e)=>{F.value=e,b.value=1,h()},ee=()=>{b.value=1,h()},ae=()=>M.value=!0,R=()=>M.value=!1,te=()=>{v.purchaser_name="",v.contact_phone=""},le=()=>{R(),b.value=1,C.value="",h()},j=()=>{g.value=!1,S.value=!0,T()},E=l=>{g.value=!0,S.value=!0,T(),Object.assign(s,l),l.avatar_url&&(z.value=[{uid:`${l.id}_avatar`,name:"avatar.png",url:l.avatar_url||J}])},$=()=>{S.value=!1,z.value=[]},T=()=>{var l;(l=O.value)==null||l.resetFields(),Object.assign(s,{id:0,purchaser_name:"",contact_person:"",contact_phone:"",address:"",receive_address:"",bank_name:"",bank_account:"",tax_no:"",remark:"",avatar:""})},ne=l=>{const e=l.type.startsWith("image/"),k=l.size/1024/1024<2;return e||d.error("请上传图片格式文件"),k||d.error("图片大小不超过2MB"),e&&k},se=l=>{if(l.file.status==="done"){const e=l.file.response;e.code===200?(s.avatar=e.data.url,z.value=[{uid:l.file.uid,name:l.file.name||"avatar.png",url:e.data.url}],d.success("头像上传成功")):d.error(e.message||"头像上传失败")}else l.file.status==="error"&&d.error("头像上传失败")},oe=async()=>{D.value=!0;try{let l;if(g.value)l=await Ge(s);else{const{id:e,...k}=s;l=await He(k)}l.code===200?(d.success(g.value?"修改成功":"新增成功"),$(),h()):d.error(l.message||(g.value?"修改失败":"新增失败"))}catch(l){console.error("提交异常：",l),d.error(g.value?"修改失败":"新增失败")}finally{D.value=!1}},re=l=>{x.value=l,P.value="确定删除该采购商吗？删除后不可恢复！",U.value=!0},ue=()=>{x.value=m.value,P.value=`确定删除选中的${m.value.length}个采购商吗？`,U.value=!0},K=()=>U.value=!1,de=async()=>{y.value=!0;try{const l=Array.isArray(x.value)?x.value:[x.value];await Promise.all(l.map(e=>Je({id:e}))),d.success("删除成功"),K(),m.value=[],h()}catch(l){console.error("删除异常：",l),d.error("删除失败")}finally{y.value=!1}};return(l,e)=>{const k=Fe,c=Be,ie=De,ce=Ce,pe=Qe,Q=Ve,_e=Le,ve=Ne,me=qe,ge=Se,fe=ze,p=je,u=Re,W=Oe,G=Ue,he=Ke("a-icon"),ye=Ee,be=Te,ke=Ae;return _(),A("div",Ye,[a(ce,{title:"采购商信息管理",breadcrumb:{routes:[{path:"",name:"基础信息管理"},{path:"",name:"采购商信息"}]},style:{"margin-bottom":"20px"}},{extra:n(()=>[a(ie,{size:"middle"},{default:n(()=>[a(k,{value:C.value,"onUpdate:value":e[0]||(e[0]=t=>C.value=t),placeholder:"请输入采购商名模糊搜索","allow-clear":"",style:{width:"300px"},onSearch:ee},null,8,["value"]),a(c,{type:"default",icon:"search",onClick:ae},{default:n(()=>[...e[13]||(e[13]=[i(" 高级搜索 ",-1)])]),_:1}),a(c,{type:"primary",icon:"plus",onClick:j},{default:n(()=>[...e[14]||(e[14]=[i(" 新增采购商 ",-1)])]),_:1}),a(c,{type:"default",danger:"",icon:"delete",disabled:m.value.length===0,onClick:ue},{default:n(()=>[...e[15]||(e[15]=[i(" 批量删除 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),o("div",Ze,[y.value?(_(),w(pe,{key:0,active:!0,style:{width:"100%"}})):(_(),w(ge,{key:1,gutter:[24,24]},{default:n(()=>[V.value.length===0?(_(),w(Q,{key:0,span:24},{default:n(()=>[a(H(Me),{description:"暂无采购商信息，点击右上角「新增采购商」添加",style:{margin:"40px 0"}},{default:n(()=>[a(c,{type:"primary",icon:"plus",onClick:j},{default:n(()=>[...e[16]||(e[16]=[i(" 新增采购商 ",-1)])]),_:1})]),_:1})]),_:1})):N("",!0),(_(!0),A(Pe,null,$e(V.value,t=>(_(),w(Q,{span:8,key:t.id},{default:n(()=>[a(H(Ie),{class:"purchaser-card",hoverable:"",bordered:!1,onClick:()=>E(t)},{default:n(()=>[o("div",ea,[a(_e,{value:t.id,checked:m.value.includes(t.id),onChange:[L=>L.target.checked?m.value.push(t.id):m.value.splice(m.value.indexOf(t.id),1),e[1]||(e[1]=I(()=>{},["stop"]))],style:{"margin-right":"12px"}},null,8,["value","checked","onChange"]),a(ve,{src:t.avatar_url||J,size:64,class:"purchaser-avatar"},null,8,["src"])]),o("div",aa,[o("div",ta,[e[17]||(e[17]=o("span",{class:"label"},"采购商名：",-1)),o("span",la,f(t.purchaser_name),1)]),o("div",na,[e[18]||(e[18]=o("span",{class:"label"},"联系人：",-1)),o("span",sa,f(t.contact_person),1)]),o("div",oa,[e[19]||(e[19]=o("span",{class:"label"},"联系电话：",-1)),o("span",ra,f(t.contact_phone),1)]),o("div",{class:"info-item ellipsis",title:t.company_address||"未填写"},[e[20]||(e[20]=o("span",{class:"label"},"公司地址：",-1)),o("span",da,f(t.company_address||"未填写"),1)],8,ua),o("div",{class:"info-item ellipsis",title:t.receive_address||"未填写"},[e[21]||(e[21]=o("span",{class:"label"},"收货地址：",-1)),o("span",ca,f(t.receive_address||"未填写"),1)],8,ia),o("div",pa,[e[22]||(e[22]=o("span",{class:"label"},"创建时间：",-1)),o("span",_a,f(t.create_time),1)]),t.remark?(_(),w(me,{key:0,color:"blue",title:t.remark},{default:n(()=>[...e[23]||(e[23]=[i(" 有备注 ",-1)])]),_:1},8,["title"])):N("",!0)]),o("div",va,[a(c,{type:"text",onClick:I(L=>E(t),["stop"])},{default:n(()=>[...e[24]||(e[24]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(c,{type:"text",danger:"",onClick:I(L=>re(t.id),["stop"])},{default:n(()=>[...e[25]||(e[25]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),B.value>0?(_(),w(fe,{key:2,current:b.value,"page-size":F.value,total:B.value,"show-size-changer":"","show-total":t=>`共 ${t} 条记录`,style:{"margin-top":"24px","text-align":"right"},onChange:Y,onShowSizeChange:Z},null,8,["current","page-size","total","show-total"])):N("",!0)]),a(G,{title:"高级搜索",open:M.value,width:"400px",onClose:R},{default:n(()=>[a(W,{model:v,layout:"vertical",onFinish:le},{default:n(()=>[a(u,{label:"采购商名",name:"purchaser_name"},{default:n(()=>[a(p,{value:v.purchaser_name,"onUpdate:value":e[2]||(e[2]=t=>v.purchaser_name=t),placeholder:"请输入采购商名","allow-clear":""},null,8,["value"])]),_:1}),a(u,{label:"联系电话",name:"contact_phone"},{default:n(()=>[a(p,{value:v.contact_phone,"onUpdate:value":e[3]||(e[3]=t=>v.contact_phone=t),placeholder:"请输入联系电话","allow-clear":""},null,8,["value"])]),_:1}),o("div",ma,[a(c,{type:"default",onClick:te,style:{"margin-right":"8px"}},{default:n(()=>[...e[26]||(e[26]=[i(" 重置 ",-1)])]),_:1}),a(c,{type:"primary","html-type":"submit"},{default:n(()=>[...e[27]||(e[27]=[i(" 查询 ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1},8,["open"]),a(G,{title:g.value?"编辑采购商":"新增采购商",open:S.value,width:"600px","destroy-on-close":"",onClose:$},{default:n(()=>[a(W,{ref_key:"purchaserFormRef",ref:O,model:s,rules:X,layout:"vertical",onFinish:oe},{default:n(()=>[a(u,{label:"采购商头像",name:"avatar"},{default:n(()=>[a(ye,{action:ya,"list-type":"picture-card","file-list":z.value,"before-upload":ne,onChange:se,"show-upload-list":!1},{default:n(()=>[s.avatar?(_(),A("img",{key:0,src:s.avatar,width:"100",height:"100"},null,8,ga)):(_(),A("div",fa,[a(he,{type:y.value?"loading":"plus"},null,8,["type"]),e[28]||(e[28]=o("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),a(u,{label:"采购商名",name:"purchaser_name"},{default:n(()=>[a(p,{value:s.purchaser_name,"onUpdate:value":e[4]||(e[4]=t=>s.purchaser_name=t),placeholder:"请输入采购商名","allow-clear":"",maxlength:50,"show-word-limit":""},null,8,["value"])]),_:1}),a(u,{label:"联系人",name:"contact_person"},{default:n(()=>[a(p,{value:s.contact_person,"onUpdate:value":e[5]||(e[5]=t=>s.contact_person=t),placeholder:"请输入联系人","allow-clear":"",maxlength:20,"show-word-limit":""},null,8,["value"])]),_:1}),a(u,{label:"联系电话",name:"contact_phone"},{default:n(()=>[a(p,{value:s.contact_phone,"onUpdate:value":e[6]||(e[6]=t=>s.contact_phone=t),placeholder:"请输入手机号/固话","allow-clear":"",maxlength:20},null,8,["value"])]),_:1}),a(u,{label:"公司地址",name:"address"},{default:n(()=>[a(p,{value:s.company_address,"onUpdate:value":e[7]||(e[7]=t=>s.company_address=t),placeholder:"请输入公司地址","allow-clear":"",maxlength:200,"show-word-limit":""},null,8,["value"])]),_:1}),a(u,{label:"收货地址",name:"receive_address"},{default:n(()=>[a(p,{value:s.receive_address,"onUpdate:value":e[8]||(e[8]=t=>s.receive_address=t),placeholder:"请输入收货地址","allow-clear":"",maxlength:200,"show-word-limit":""},null,8,["value"])]),_:1}),a(u,{label:"开户行",name:"bank_name"},{default:n(()=>[a(p,{value:s.bank_name,"onUpdate:value":e[9]||(e[9]=t=>s.bank_name=t),placeholder:"请输入开户行","allow-clear":"",maxlength:50,"show-word-limit":""},null,8,["value"])]),_:1}),a(u,{label:"银行账号",name:"bank_account"},{default:n(()=>[a(p,{value:s.bank_account,"onUpdate:value":e[10]||(e[10]=t=>s.bank_account=t),placeholder:"请输入银行账号","allow-clear":"",maxlength:30,"show-word-limit":""},null,8,["value"])]),_:1}),a(u,{label:"税号",name:"tax_no"},{default:n(()=>[a(p,{value:s.tax_no,"onUpdate:value":e[11]||(e[11]=t=>s.tax_no=t),placeholder:"请输入税号","allow-clear":"",maxlength:20,"show-word-limit":""},null,8,["value"])]),_:1}),a(u,{label:"备注",name:"remark"},{default:n(()=>[a(be,{value:s.remark,"onUpdate:value":e[12]||(e[12]=t=>s.remark=t),placeholder:"请输入备注","allow-clear":"",rows:3,maxlength:200,"show-word-limit":""},null,8,["value"])]),_:1}),o("div",ha,[a(c,{type:"default",onClick:$,style:{"margin-right":"8px"}},{default:n(()=>[...e[29]||(e[29]=[i(" 取消 ",-1)])]),_:1}),a(c,{type:"primary","html-type":"submit",loading:D.value},{default:n(()=>[i(f(g.value?"保存修改":"新增"),1)]),_:1},8,["loading"])])]),_:1},8,["model","rules"])]),_:1},8,["title","open"]),a(ke,{title:"确认删除",open:U.value,onOk:de,onCancel:K,"ok-text":"确认删除","cancel-text":"取消","ok-type":"danger"},{default:n(()=>[o("p",null,f(P.value),1)]),_:1},8,["open"])])}}}),za=Xe(ba,[["__scopeId","data-v-f3523e87"]]);export{za as default};
